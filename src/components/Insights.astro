---
import { getCollection } from 'astro:content';

const allPosts = await getCollection('insights');

// Sort by date (newest first) and take first 3 for homepage preview
const posts = allPosts
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3)
  .map(post => ({
    slug: post.id.replace(/\.md$/, ''),
    title: post.data.title,
    date: post.data.date,
    readTime: post.data.readTime,
    excerpt: post.data.excerpt,
  }));
---

<section id="insights" class="py-20 px-6 bg-cream">
  <div class="max-w-4xl mx-auto">
    <h2 class="text-3xl font-light text-charcoal mb-4">Insights</h2>
    <p class="text-graphite mb-12">
      Practical perspectives from the field of transformation.
    </p>

    <div class="space-y-6">
      {posts.map((post) => (
        <a href={`/insights/${post.slug}`} class="block card-hover bg-white rounded-lg p-8 border border-gray-100 group">
          <article>
            <h3 class="text-xl font-medium text-charcoal mb-3 group-hover:text-deep-sage transition-colors">{post.title}</h3>

            <div class="flex items-center gap-4 text-sm text-taupe mb-4">
              <span class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                {post.date}
              </span>
              <span class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                {post.readTime}
              </span>
            </div>

            <p class="text-graphite mb-4">{post.excerpt}</p>

            <span class="inline-flex items-center gap-2 text-charcoal group-hover:text-deep-sage transition-colors">
              Read More
              <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </span>
          </article>
        </a>
      ))}
    </div>

    <div class="mt-8 text-center">
      <a href="/insights" class="inline-flex items-center gap-2 text-charcoal hover:text-deep-sage transition-colors">
        View All Insights
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </div>
</section>
